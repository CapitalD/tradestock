{% extends "layout.html" %}

{% block body %}
  <h1>Allocate <em>{{stockitem.name}}</em> to a job</h1>
  <h3>Current stock: {{ stockitem.quantity }}</h3>
  <form action="" method="post" name="allocate_stock">
    {{ form.hidden_tag() }}

    <div class="row">
      <div class="six columns">
        <label for="job">
          Select a job
          {% if form.job.flags.required %}<span class="required-indicator">*</span>{% endif %}
          {% for error in form.job.errors %}
            <span style="color: #f33;">[{{ error }}]</span>
          {% endfor %}
        </label>
        {{ form.job }}
      </div>
    </div>

    <div class="row">
      <div class="six columns">
        <label>
          Allocate all or some?
          {% if form.split.flags.required %}<span class="required-indicator">*</span>{% endif %}
        </label>
        {% for subfield in form.split %}
          <label for="{{ subfield.label.field_id}}">
            {{ subfield }}
            <span class="label-body">{{ subfield.label.text }}</span>
          </label>
        {% endfor %}
      </div>

      <div id="split_quantity" class="six columns hide">
        <label for="split_quantity">
          Enter quantity to allocate
          <span class="required-indicator">*</span>
          {% for error in form.split_quantity.errors %}
            <span style="color: #f33;">[{{ error }}]</span>
          {% endfor %}
        </label>
        {{ form.split_quantity(type='number') }}
      </div>

      <div id="split_percentage" class="six columns hide">
        <label for="split_percentage">
          Enter percentage to allocate
          <span class="required-indicator">*</span>
          {% for error in form.split_percentage.errors %}
            <span style="color: #f33;">[{{ error }}]</span>
          {% endfor %}
        </label>
        {{ form.split_percentage(type='number') }}
      </div>
    </div>

    <div class="row">
      <div class="six columns">
        <a class="button" href="{{ url_for('index') }}">Cancel</a>
        <input class="button button-primary" type="submit" name="submit" value="Save">
      </div>
    </div>
  </form>
{% endblock %}
{% block domready %}
  show_split_field($('input[name=split]:checked').val());

  $('input[name=split]:radio').change(function() {
    show_split_field(this.value);
  });

{% endblock %}
{% block script %}

function show_split_field(value) {
  $("#split_quantity").hide();
  $("#split_percentage").hide();
  switch (value) {
    case "2":
      $("#split_quantity").show();
      break;
    case "3":
      $("#split_percentage").show();
      break;
  }
}
{% endblock %}
